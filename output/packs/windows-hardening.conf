{
  "platform": "windows",
  "queries": {
    "AppCompat": {
      "description": "Check Applications opted in for DEP",
      "interval": "86400",
      "query": "select * from registry where key='HKEY_LOCAL_MACHINE\\SOFTWARE\\%Microsoft\\Windows NT\\CurrentVersion\\AppCompatFlags\\Layers'",
      "snapshot": true
    },
    "App_ExecuteOptions": {
      "description": "Check Applications opted in for DEP",
      "interval": "86400",
      "query": "select * from registry where key like 'HKEY_LOCAL_MACHINE\\SOFTWARE\\%Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\%\\executeOptions'",
      "snapshot": true
    },
    "App_MitigationOptions": {
      "description": "Check Applications opted in for DEP",
      "interval": "86400",
      "query": "select * from registry where key like 'HKEY_LOCAL_MACHINE\\SOFTWARE\\%Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\%\\MitigationOptions'",
      "snapshot": true
    },
    "App_disabledExceptionChainValidation": {
      "description": "Check Applications not supporting SEHOP",
      "interval": "86400",
      "query": "select * from registry where key like 'HKEY_LOCAL_MACHINE\\SOFTWARE\\%Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\%\\DisableExceptionChainValidation'",
      "snapshot": true
    },
    "AuditSpecialGroups": {
      "description": "Check Special Logon Audit configuration - https://blogs.technet.microsoft.com/jepayne/2015/11/26/tracking-lateral-movement-part-one-special-groups-and-specific-service-accounts/",
      "interval": "86400",
      "query": "select * from registry where key='HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Lsa\\Audit'",
      "snapshot": true
    },
    "ControlFlowGuard": {
      "description": "Check Control Flow Guard state",
      "interval": "86400",
      "query": "select * from registry where key='HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\Memory Management\\EnableCfg'",
      "snapshot": true
    },
    "CwdIllegalInDllSearch": {
      "description": "Check Secure Search Path state (https://support.microsoft.com/en-us/help/2264107/a-new-cwdillegalindllsearch-registry-entry-is-available-to-control-the)",
      "interval": "86400",
      "query": "select * from registry where key='HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\CWDIllegalInDllSearch'",
      "snapshot": true
    },
    "DefaultLevelMachine": {
      "description": "Check Software Restriction Policies state",
      "interval": "86400",
      "query": "select * from registry where key='HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\Safer\\CodeIdentifiers\\DefaultLevel'",
      "snapshot": true
    },
    "DefaultLevelUser": {
      "description": "Check Software Restriction Policies state",
      "interval": "86400",
      "query": "select * from registry where key like 'HKEY_USERS\\%\\SOFTWARE\\Policies\\Microsoft\\Windows\\Safer\\CodeIdentifiers\\DefaultLevel'",
      "snapshot": true
    },
    "DepPolicy": {
      "description": "Whether DEP is enabled",
      "interval": "86400",
      "query": "select * from registry where key='HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\SystemStartOptions'",
      "snapshot": true
    },
    "DeveloperMode": {
      "description": "Check Developer Mode state",
      "interval": "86400",
      "query": "select * from registry where key='HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\AppModelUnlock'",
      "snapshot": true
    },
    "DisabledExceptionChainValidation": {
      "description": "Check SEHOP state: DisabledExceptionChainValidation",
      "interval": "86400",
      "query": "select * from registry where key='HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\kernel\\DisableExceptionChainValidation'",
      "snapshot": true
    },
    "Disallowed": {
      "description": "Check Software Restriction Policies state: No SRP blacklist rules",
      "interval": "86400",
      "query": "select * from registry where key='HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\Safer\\CodeIdentifiers\\0'",
      "snapshot": true
    },
    "Disallowed_Paths": {
      "description": "Check Software Restriction Policies state: No SRP path rules",
      "interval": "86400",
      "query": "select * from registry where key='HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\Safer\\CodeIdentifiers\\0\\Paths'",
      "snapshot": true
    },
    "Disallowed_Paths_ItemData": {
      "description": "Check Software Restriction Policies state: SRP blacklist rule is missing",
      "interval": "86400",
      "query": "select * from registry where key like 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\Safer\\CodeIdentifiers\\0\\Paths\\%\\ItemData'",
      "snapshot": true
    },
    "EnableCertPaddingCheck": {
      "description": "Determine state of Certificate Padding (https://docs.microsoft.com/en-us/security-updates/securityadvisories/2014/2915720)",
      "interval": "86400",
      "query": "select * from registry where key='HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Cryptography\\WinTrust\\Config\\EnableCertPaddingCheck'",
      "snapshot": true
    },
    "EnableCertPaddingCheck_wow64": {
      "description": "Determine state of Certificate Padding (https://docs.microsoft.com/en-us/security-updates/securityadvisories/2014/2915720)",
      "interval": "86400",
      "query": "select * from registry where key='HKEY_LOCAL_MACHINE\\SOFTWARE\\Wow6432Node\\Microsoft\\Cryptography\\WinTrust\\Config\\EnableCertPaddingCheck'",
      "snapshot": true
    },
    "EnableLowVaAccess": {
      "description": "Check Kernel Null page state",
      "interval": "86400",
      "query": "select * from registry where key='HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\Memory Management\\EnableLowVaAccess'",
      "snapshot": true
    },
    "ExecutableTryMachine": {
      "description": "Check Software Restriction Policies state",
      "interval": "86400",
      "query": "select * from registry where key='HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\Safer\\CodeIdentifiers\\ExecutableTry'",
      "snapshot": true
    },
    "ExecutableTryUser": {
      "description": "Check Software Restriction Policies state",
      "interval": "86400",
      "query": "select * from registry where key like 'HKEY_USERS\\%\\SOFTWARE\\Policies\\Microsoft\\Windows\\Safer\\CodeIdentifiers\\ExecutableTry'",
      "snapshot": true
    },
    "FontBlocking": {
      "description": "Whether FontBlocking is enabled",
      "interval": "86400",
      "query": "select * from registry where key='HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows NT\\MitigationOptions\\MitigationOptions_FontBlocking'",
      "snapshot": true
    },
    "KernelSehopEnabled": {
      "description": "Whether SEHOP is enabled",
      "interval": "86400",
      "query": "select * from registry where key='HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\Kernel\\KernelSEHOPEnabled'",
      "snapshot": true
    },
    "MitigationOptions": {
      "description": "Whether DEP is enabled with application mitigation options",
      "interval": "86400",
      "query": "select * from registry where key='HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\Kernel\\MitigationOptions'",
      "snapshot": true
    },
    "MoveImages": {
      "description": "Check ASLR configuration",
      "interval": "86400",
      "query": "select * from registry where key='HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\Memory Management\\moveImages'",
      "snapshot": true
    },
    "OpenType_Font_Driver_Vulnerability": {
      "description": "Determine if Adobe Type Manager Font Driver is disabled (https://technet.microsoft.com/en-us/library/security/ms15-078)",
      "interval": "3600",
      "query": "select * from registry where path like 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Windows\\%' AND name = 'DisableATMFD' AND data != '1';",
      "version": "2.2.1"
    },
    "PolicyScopeMachine": {
      "description": "Check Software Restriction Policies state",
      "interval": "86400",
      "query": "select * from registry where key='HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\Safer\\CodeIdentifiers\\PolicyScope'",
      "snapshot": true
    },
    "PolicyScopeUser": {
      "description": "Check Software Restriction Policies state",
      "interval": "86400",
      "query": "select * from registry where key like 'HKEY_USERS\\%\\SOFTWARE\\Policies\\Microsoft\\Windows\\Safer\\CodeIdentifiers\\PolicyScope'",
      "snapshot": true
    },
    "Protecting_Against_Weak_Crypto_Algo": {
      "description": "Determine if Windows is configured to log certificates with weak crypto (https://technet.microsoft.com/library/dn375961(v=ws.11).aspx)",
      "interval": "3600",
      "query": "select * from registry where path like 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Cryptography\\OID\\EncodingType 0\\CertDllCreateCertificateChainEngine\\Config\\Default\\%' AND name IN ('WeakSha1ThirdPartyFlags','WeakMd5ThirdPartyFlags') AND type = 'REG_DWORD' AND data not like '-2%';",
      "value": "Artifact used by this malware",
      "version": "2.2.1"
    },
    "Rule": {
      "description": "Check Applocker rule set",
      "interval": "86400",
      "query": "select * from registry where key like 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\SrpV2\\%\\%\\Value'",
      "snapshot": true
    },
    "RuleSetEnforcementMode": {
      "description": "Check Applocker rule set configuration",
      "interval": "86400",
      "query": "select * from registry where key like 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\SrpV2\\%\\EnforcementMode'",
      "snapshot": true
    },
    "SaferFlags": {
      "description": "Check Software Restriction Policies state: SRP rule is not enforcing",
      "interval": "86400",
      "query": "select * from registry where key like 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\Safer\\CodeIdentifiers\\%\\%\\%\\SaferFlags'",
      "snapshot": true
    },
    "SecureBoot": {
      "description": "Whether Secureboot is enabled",
      "interval": "86400",
      "query": "select * from registry where key='HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\SecureBoot\\State\\UEFISecureBootEnabled'",
      "snapshot": true
    },
    "SysmonConfig": {
      "description": "Check Microsoft Sysinternals Sysmon config",
      "interval": "86400",
      "query": "select * from registry where key='HKEY_LOCAL_MACHINE\\SYSTEM\\CCS\\Services\\SysmonDrv\\Parameters'",
      "snapshot": true
    },
    "TransparentEnabledMachine": {
      "description": "Check Software Restriction Policies state",
      "interval": "86400",
      "query": "select * from registry where key='HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\Safer\\CodeIdentifiers\\TransparentEnabled'",
      "snapshot": true
    },
    "TransparentEnabledUser": {
      "description": "Check Software Restriction Policies state",
      "interval": "86400",
      "query": "select * from registry where key like 'HKEY_USERS\\%\\SOFTWARE\\Policies\\Microsoft\\Windows\\Safer\\CodeIdentifiers\\TransparentEnabled'",
      "snapshot": true
    },
    "UAC_Disabled": {
      "description": "Controls UAC. A setting of 0 indicates that UAC is disabled.",
      "interval": 3600,
      "query": "SELECT * FROM registry WHERE path='HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\EnableLUA' AND data=0;",
      "version": "2.2.1"
    },
    "Unrestricted": {
      "description": "Check Software Restriction Policies state: No SRP whitelist rules",
      "interval": "86400",
      "query": "select * from registry where key='HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\Safer\\CodeIdentifiers\\262144'",
      "snapshot": true
    },
    "Unrestricted_Paths": {
      "description": "Check Software Restriction Policies state: No SRP path rules",
      "interval": "86400",
      "query": "select * from registry where key='HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\Safer\\CodeIdentifiers\\262144\\Paths'",
      "snapshot": true
    },
    "Unrestricted_Paths_ItemData": {
      "description": "Check Software Restriction Policies state: SRP whitelist rules is missing",
      "interval": "86400",
      "query": "select * from registry where key like 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\Safer\\CodeIdentifiers\\262144\\Paths\\%\\ItemData'",
      "snapshot": true
    }
  }
}
